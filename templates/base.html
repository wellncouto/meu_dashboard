<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Meu App Fin{% endblock %}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Manrope', sans-serif;
            overflow-x: hidden;
        }
        .bottom-nav-shadow {
           box-shadow: 0 -4px 12px -1px rgba(0, 0, 0, 0.08), 0 -2px 8px -1px rgba(0, 0, 0, 0.05);
        }
        main { padding-bottom: 6rem; }
        @media (min-width: 1024px) { main { padding-bottom: 0; } }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }

        /* Novo estilo para o botão WhatsApp */
        .whatsapp-button {
            background-color: #128C7E; /* Novo verde WhatsApp (mais escuro/sóbrio) */
            color: white !important; /* Garante que o texto seja branco */
        }
        .whatsapp-button:hover {
            background-color: #0D6E5F; /* Tom mais escuro para hover */
        }
        .whatsapp-button svg { /* Garante que o SVG do WhatsApp seja branco */
            color: white !important;
        }

        {% block head_style %}{% endblock %}
    </style>
    {% block head_script %}{% endblock %}
</head>
<body class="{% block body_class %}bg-gray-100 lg:bg-gray-200{% endblock %}">

    <div class="flex flex-col lg:flex-row min-h-screen lg:p-6 lg:gap-6 relative">

        <aside id="sidebar"
               class="fixed inset-y-0 left-0 bg-black w-64 p-4 transform -translate-x-full z-40 transition-transform duration-300 ease-in-out
                      flex flex-col shadow-xl
                      lg:sticky lg:top-6 lg:flex-shrink-0 lg:max-h-[calc(100vh-3rem)] lg:rounded-2xl lg:translate-x-0 lg:shadow-xl">

            <button id="close-sidebar-btn" aria-label="Fechar menu lateral" class="absolute top-3 right-3 text-gray-500 hover:text-white lg:hidden p-1 rounded-md hover:bg-white/10 z-50">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>

            <div class="mb-0 px-0 flex items-center justify-start mt-0">
                 <img src="https://moneda.pro/files/2.png" alt="Moneda Logo" class="h-25 w-auto"> {# Ajuste h-12 ou o tamanho desejado #}
            </div>

            <nav class="flex-grow space-y-1.5 overflow-y-auto">
                <ul>
                {% set nav_links = [
                    {
                        'endpoint': 'dashboard', 'label': 'Inicio',
                        'icon_svg': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>'
                    },
                    {
                        'endpoint': 'gastos', 'label': 'Gastos',
                        'icon_svg': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect><line x1="1" y1="10" x2="23" y2="10"></line></svg>'
                    },
                    {
                        'endpoint': 'receitas', 'label': 'Ingresos',
                        'icon_svg': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect></svg>'
                    },
                    {
                        'endpoint': 'lembretes', 'label': 'Recordatorios',
                        'icon_svg': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg>'
                    },
                    {
                        'endpoint': 'relatorios', 'label': 'Reportes',
                        'icon_svg': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg>'
                    },
                    {
                        'endpoint': 'categorias', 'label': 'Categorías',
                        'icon_svg': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>'
                    }
                ] %}

                {% for link in nav_links %}
                <li>
                    <a href="{{ url_for(link.endpoint) }}"
                       class="flex items-center px-3 py-2.5
                              text-sm font-medium rounded-lg
                              group transition-colors duration-150 ease-in-out
                              {% if request.endpoint == link.endpoint %}
                                  bg-[#55d83f] text-black shadow-sm
                              {% else %}
                                  text-gray-400 hover:bg-gray-800 hover:text-gray-100
                              {% endif %}">

                        {% set icon_color_class = 'text-black' if request.endpoint == link.endpoint else 'text-gray-500 group-hover:text-gray-300' %}
                        {{ link.icon_svg | replace('<svg', '<svg class="w-6 h-6 flex-shrink-0 ' + icon_color_class + '"') | safe }}
                        <span class="ml-3">{{ link.label }}</span>
                    </a>
                </li>
                {% endfor %}
                </ul>
            </nav>

            <div class="mt-auto pt-4 border-t border-gray-700">
                <a href="https://wa.me/551152864213?text=Hola%20Moneda" class="flex items-center px-3 py-2.5 text-sm font-medium rounded-lg group transition-colors duration-150 ease-in-out whatsapp-button mt-2">
                    <svg class="w-6 h-6 flex-shrink-0" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.52.074-.792.372s-1.04 1.016-1.04 2.479 1.065 2.876 1.213 3.074c.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.626.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.289.173-1.413z"/></svg>
                    <span class="ml-3">WhatsApp Moneda</span>
                </a>


                </a>
            </div>
        </aside>

        <div class="flex-1 flex flex-col lg:rounded-2xl lg:bg-white lg:shadow-xl lg:overflow-hidden">
            <header id="navbar-superior" class="bg-white shadow-sm sticky top-0 z-20 lg:static lg:shadow-none lg:border-b lg:border-gray-200">
                <div class="px-4 sm:px-6 lg:px-8 w-full">
                    <div class="flex items-center justify-between h-16">
                        <div class="flex items-center">
                            <button id="open-sidebar-btn-navbar" aria-label="Abrir menu lateral" class="text-gray-500 hover:text-gray-700 focus:outline-none focus:text-gray-700 lg:hidden mr-3 p-1 rounded hover:bg-gray-100">
                                <svg class="h-6 w-6" stroke="currentColor" fill="none" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7" />
                                </svg>
                            </button>
                        </div>

                        <div class="flex items-center">
                            <div class="ml-3 relative">
                                <div>
                                    <button type="button" class="max-w-xs bg-white flex items-center text-sm rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#55d83f]" id="user-menu-button" aria-expanded="false" aria-haspopup="true">
                                        <span class="sr-only">Abrir menu do usuário</span>
                                        <span class="inline-flex items-center justify-center h-9 w-9 rounded-full bg-gray-200 text-gray-700">
                                            <span class="text-sm font-medium leading-none">{{ user_nome[0] | upper if user_nome else 'U' }}</span>
                                        </span>
                                        <span class="hidden md:block ml-2 text-sm font-medium text-gray-700 hover:text-black">{{ user_nome }}</span>
                                        <svg class="hidden md:block ml-1 h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                                        </svg>
                                    </button>
                                </div>
                                <div id="user-menu-dropdown" class="origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg py-1 bg-white ring-1 ring-black ring-opacity-5 focus:outline-none hidden" role="menu" aria-orientation="vertical" aria-labelledby="user-menu-button" tabindex="-1">
                                    <a href="{{ url_for('logout') }}" class="block px-4 py-2 text-sm text-red-600 hover:bg-red-50 hover:text-red-700" role="menuitem" tabindex="-1">Salir</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <main id="main-content" class="flex-1 p-4 sm:p-6 lg:p-8 overflow-y-auto bg-gray-100 lg:bg-white">
                <div class="max-w-7xl mx-auto">
                    {% block content_body %}
                    <h2 class="text-2xl font-semibold text-gray-900">Página de Exemplo</h2>
                    <p class="mt-2 text-gray-600">Este é um conteúdo de exemplo para demonstrar o layout.</p>
                    <div class="mt-6 h-96 bg-gray-300 rounded-lg flex items-center justify-center">
                        <span class="text-gray-500">Conteúdo Principal Aqui</span>
                    </div>
                    {% endblock %}
                </div>
            </main>
        </div>
    </div>

    <nav id="mobile-bottom-nav"
         class="lg:hidden fixed bottom-0 inset-x-0 z-30">
        <div class="relative">
            <div class="absolute left-1/2 top-0 transform -translate-x-1/2 -translate-y-1/2 z-50">
                {% if request.endpoint == 'dashboard' %}
                    <button id="open-add-modal-fab-mobile" aria-label="Adicionar novo item"
                            class="bg-[#55d83f] text-white rounded-full p-3 shadow-lg focus:outline-none w-16 h-16 flex items-center justify-center ring-4 ring-white dark:ring-gray-100">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
                        </svg>
                    </button>
                {% else %}
                    <a href="{{ url_for('dashboard') }}" aria-label="Ir para o Dashboard"
                            class="bg-[#55d83f] text-white rounded-full p-3 shadow-lg focus:outline-none w-16 h-16 flex items-center justify-center ring-4 ring-white dark:ring-gray-100">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                    </a>
                {% endif %}
            </div>

            <div class="bg-white dark:bg-gray-800 bottom-nav-shadow rounded-t-3xl px-6 pt-2 pb-3 h-16 flex justify-around items-center max-w-screen-sm mx-auto relative">
                {% set bottom_nav_items = [
                    {'endpoint': 'relatorios', 'label': 'Relatórios', 'icon_svg': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg>'},
                    {'endpoint': 'gastos', 'label': 'Gastos', 'icon_svg': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect><line x1="1" y1="10" x2="23" y2="10"></line></svg>'},
                    {'endpoint': 'receitas', 'label': 'Receitas', 'icon_svg': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect></svg>'},
                    {'endpoint': 'lembretes', 'label': 'Lembretes', 'icon_svg': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg>'}
                ] %}

                {% for i in range(5) %}
                    {% if i == 2 %}
                        <div class="w-1/5"></div>
                    {% else %}
                        {% set link_index = i if i < 2 else i - 1 %}
                        {% if link_index < bottom_nav_items|length %}
                            {% set link = bottom_nav_items[link_index] %}
                            <a href="{{ url_for(link.endpoint) }}"
                               class="flex flex-col items-center justify-center w-1/5 text-center group focus:outline-none">
                                <span class="flex items-center justify-center h-10 w-10 rounded-full transition-colors duration-200 ease-in-out
                                    {% if request.endpoint == link.endpoint %}
                                        bg-black text-white
                                    {% else %}
                                        bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400 group-hover:bg-gray-200 dark:group-hover:bg-gray-600
                                    {% endif %}">
                                    {{ link.icon_svg | replace('<svg', '<svg class="h-6 w-6"') | safe }}
                                </span>
                            </a>
                        {% endif %}
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    </nav>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        console.log("Base JS: DOMContentLoaded disparado.");

        const sidebar = document.getElementById('sidebar');
        const openSidebarBtnNavbar = document.getElementById('open-sidebar-btn-navbar');
        const closeSidebarBtn = document.getElementById('close-sidebar-btn');
        const userMenuButton = document.getElementById('user-menu-button');
        const userMenuDropdown = document.getElementById('user-menu-dropdown');

        if (openSidebarBtnNavbar && sidebar) {
            console.log("Base JS: Botão de abrir sidebar e sidebar encontrados.");
            openSidebarBtnNavbar.addEventListener('click', (e) => {
                console.log("Base JS: Botão de abrir sidebar CLICADO.");
                e.stopPropagation();
                sidebar.classList.remove('-translate-x-full');
                console.log("Base JS: Classe -translate-x-full REMOVIDA da sidebar.");

                if (window.innerWidth < 1024) {
                    let overlay = document.getElementById('sidebar-overlay');
                    if (!overlay) {
                        console.log("Base JS: Criando overlay da sidebar...");
                        overlay = document.createElement('div');
                        overlay.id = 'sidebar-overlay';
                        overlay.className = 'fixed inset-0 bg-black/50 z-30 lg:hidden';
                        overlay.addEventListener('click', closeSidebarMenu);
                        if (sidebar.parentNode) {
                           sidebar.parentNode.insertBefore(overlay, sidebar);
                        } else {
                           console.warn("Base JS: Sidebar não tem parentNode, adicionando overlay ao body.");
                           document.body.appendChild(overlay);
                        }
                    }
                    overlay.classList.remove('hidden');
                    console.log("Base JS: Overlay da sidebar exibido.");
                }
            });
        } else {
            if (!openSidebarBtnNavbar) console.error("Base JS ERROR: Botão #open-sidebar-btn-navbar NÃO encontrado!");
            if (!sidebar) console.error("Base JS ERROR: Elemento #sidebar NÃO encontrado!");
        }

        function closeSidebarMenu() {
            console.log("Base JS: closeSidebarMenu() chamada.");
            if (sidebar) {
                sidebar.classList.add('-translate-x-full');
                console.log("Base JS: Classe -translate-x-full ADICIONADA à sidebar.");
            }
            const overlay = document.getElementById('sidebar-overlay');
            if (overlay) {
                console.log("Base JS: Removendo overlay da sidebar.");
                overlay.remove();
            }
        }

        if (closeSidebarBtn) {
            console.log("Base JS: Botão de fechar sidebar encontrado.");
            closeSidebarBtn.addEventListener('click', (e) => {
                console.log("Base JS: Botão de fechar sidebar CLICADO.");
                e.stopPropagation();
                closeSidebarMenu();
            });
        } else {
            console.warn("Base JS: Botão #close-sidebar-btn NÃO encontrado.");
        }

        if (userMenuButton && userMenuDropdown) {
            console.log("Base JS: Elementos do menu dropdown do usuário encontrados.");
            userMenuButton.addEventListener('click', function(event) {
                event.stopPropagation();
                const isExpanded = userMenuButton.getAttribute('aria-expanded') === 'true';
                userMenuButton.setAttribute('aria-expanded', String(!isExpanded));
                userMenuDropdown.classList.toggle('hidden');
                console.log("Base JS: Menu dropdown do usuário " + (isExpanded ? "fechado" : "aberto"));
            });
        } else {
            if (!userMenuButton) console.warn("Base JS: Botão #user-menu-button NÃO encontrado.");
            if (!userMenuDropdown) console.warn("Base JS: Elemento #user-menu-dropdown NÃO encontrado.");
        }

        document.addEventListener('click', (event) => {
            if (userMenuDropdown && !userMenuDropdown.classList.contains('hidden')) {
                const isClickInsideUserMenu = (userMenuButton && userMenuButton.contains(event.target)) || userMenuDropdown.contains(event.target);
                if (!isClickInsideUserMenu) {
                    userMenuDropdown.classList.add('hidden');
                    if (userMenuButton) userMenuButton.setAttribute('aria-expanded', 'false');
                    console.log("Base JS: Menu dropdown do usuário fechado por clique fora.");
                }
            }
        });

        const openAddModalFabMobile = document.getElementById('open-add-modal-fab-mobile');
        if (openAddModalFabMobile && typeof openModalContainer === 'function') {
            openAddModalFabMobile.addEventListener('click', () => {
                console.log("Base JS: Botão FAB mobile clicado.");
                const initialView = document.getElementById('modal-initial-view');
                const allModalForms = [
                    document.getElementById('modal-form-gasto-variavel'),
                    document.getElementById('modal-form-gasto-fixo'),
                    document.getElementById('modal-form-outra-receita'),
                    document.getElementById('modal-form-lembrete'),
                    document.getElementById('modal-form-meta')
                ].filter(el => el != null);

                allModalForms.forEach(form => form.classList.add('hidden'));
                if(initialView) {
                     initialView.classList.remove('hidden');
                     console.log("Base JS: View inicial do modal de adição mostrada.");
                } else {
                     console.warn("Base JS: View inicial do modal de adição (#modal-initial-view) não encontrada.");
                }
                openModalContainer();
            });
        } else if (openAddModalFabMobile) {
             console.warn("Base JS: Botão FAB mobile encontrado, mas a função openModalContainer não está definida globalmente. O modal de adição pode não abrir.");
        }

        console.log("Base JS: Todos os scripts de base foram processados.");
    });
    </script>
    {% block scripts %}{% endblock %}
</body>
</html>